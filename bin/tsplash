#!/bin/bash

#------------------------------------------------------------------------------
#
#------------------------------------------------------------------------------
main() {

    PATH=$PATH:/live/bin

    echo $cursor_off
    clear

    read_distro_release /etc/initrd-release
    : ${DISTRO_BUG_REPORT_URL:=$BUG_REPORT_URL}
    : ${DISTRO_NAME:=antiX}
    : ${DISTRO_PRETTY_NAME:=antiX-17 (generic)}

    do_welcome "$DISTRO_PRETTY_NAME"
    echo

    lao
    echo
    echo -n "${grey}Press $(mk_key Alt-F1) to see the boot process."
    echo "   Press $(mk_key Alt-F2) to return here.$nc_co"
}

#------------------------------------------------------------------------------
#
#------------------------------------------------------------------------------
mk_key() {
    local text=$1 c1=${2:-$amber} c2=${3:-$grey}
    echo "<$c1$text$c2>"
}

#------------------------------------------------------------------------------
#
#------------------------------------------------------------------------------
do_welcome() {
    local pretty_name=$1 version=$2  v_date=$3  arch
    case $(uname -m) in
          i686) arch=" 32-bit" ;;
        x86_64) arch=" 64-bit" ;;
    esac

    case $(uname -r) in
        *[pP][aA][eE]) arch="$arch pae" ;;
    esac

    pretty_name="$pretty_name$arch"
    msg  "Welcome to %s" "$(pq $pretty_name)!"
}

#------------------------------------------------------------------------------
#
#------------------------------------------------------------------------------
msg() {
    local fmt=$1 ; shift
    printf "$m_co$fmt$nc_co" "$@"
}

#------------------------------------------------------------------------------
#
#------------------------------------------------------------------------------
read_distro_release() {
    local file=$1
    test -r "$file" || return
    #sed -r -n 's/^\s*([A-Z0-9_]+=)/DISTRO_\1/p' $file >> $MY_LOG
    eval $(sed -r -n 's/^\s*([A-Z0-9_]+=)/DISTRO_\1/p' $file)
}

#------------------------------------------------------------------------------
#
#------------------------------------------------------------------------------
pq()     { echo "$hi_co$*$m_co"           ;}
#------------------------------------------------------------------------------
#
#------------------------------------------------------------------------------
set_color() {
    local e=$(printf "\e")

         black="$e[0;30m";        red="$e[0;31m";      green="$e[0;32m";
         amber="$e[0;33m";       blue="$e[0'34m";    magenta="$e[0;35m";
          cyan="$e[0;36m";    lt_grey="$e[0;37m";

          grey="$e[1;30m";    rose="$e[1;31m";  lt_green="$e[1;32m";
        yellow="$e[1;33m";  violet="$e[1;34m";      pink="$e[1;35m";
       lt_cyan="$e[1;36m";   white="$e[1;37m";

            nc_co="$e[0m";

      black_bg="$e[40m";     red_bg="$e[41m";    green_bg="$e[42m";
      amber_bg="$e[43m";    blue_bg="$e[44m";  magenta_bg="$e[45m";
       cyan_bg="$e[46m";   white_bg="$e[47m"
           rev="$e[7m";  under_line="$e[4m";         bold="$e[1m"

           hi_co=$white ;  m_co=$cyan ;

    clear="$e[2;J"; cursor_off="$e[?25l"; cursor_on="$e[?25h"
}

set_color

main "$@"
